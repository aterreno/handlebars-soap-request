<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Handlebars-soap-request by dennoa</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Handlebars-soap-request</h1>
        <p>SOAP/XML request using a Handlebars template</p>
        <p class="view"><a href="https://github.com/dennoa/handlebars-soap-request">View the Project on GitHub <small>dennoa/handlebars-soap-request</small></a></p>
        <ul>
          <li><a href="https://github.com/dennoa/handlebars-soap-request/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/dennoa/handlebars-soap-request/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/dennoa/handlebars-soap-request">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="handlebars-soap-request" class="anchor" href="#handlebars-soap-request" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>handlebars-soap-request</h1>

<p>SOAP/XML request using a Handlebars template.</p>

<p>This code only exists because I needed to handle a bunch of varied SOAP/XML service responses (some with namespaces, some without, soap11, soap12, etc...) and had to fall back to basics to get it working consistently.</p>

<p>Generate a sample service request using <a href="http://www.soapui.org/">SoapUI</a> or something similar and then make a <a href="http://handlebarsjs.com/">Handlebars</a> template from it.</p>

<h2>
<a id="example-usage" class="anchor" href="#example-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example usage</h2>

<pre><code>var soapRequest = require('handlebars-soap-request'); 

var options = {
    handlebarsTemplate: '/path/to/my/template/file',
    handlebarsParams: jsonParams,
    url: 'http://my/service/endpoint'
};

soapRequest(options, function(err, response) {

});
</code></pre>

<h4>
<a id="default-behaviour" class="anchor" href="#default-behaviour" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Default behaviour</h4>

<ul>
<li>
<p>Sends a soap12 request. </p>

<p>Specify a soapAction (see options below) to send a soap11 request.</p>
</li>
<li>
<p>Returns a JSON response using the <a href="https://www.npmjs.com/package/basic-xml2json">basic-xml2json</a> parser to parse the SOAP/XML.</p>

<p>If you don't want any XML parsing, set options.xmlResponse = true (see options below).</p>
</li>
<li>
<p>Registers a "cdata" Handlebars helper that wraps the text with &lt;![CDATA[ ... ]]&gt;. You can use it something like this:</p>

<pre><code>&lt;name&gt;{{{cdata name}}}&lt;/name&gt;
</code></pre>
</li>
<li>
<p>Registers an "xmldatetime" Handlebars helper that formats a date in standard XML date/time format (YYYY-MM-DDTHH:mm:ss.SSSZ) or an alternate custom format. For example:</p>

<pre><code>&lt;mytimestamp&gt;{{{xmldatetime myDateTime}}}&lt;/mytimestamp&gt;
&lt;mytimestamp&gt;{{{xmldatetime myDateTime myAlternateFormat}}}&lt;/mytimestamp&gt;
</code></pre>

<p>It uses <a href="http://momentjs.com/">moment</a> to format the date/time.</p>
</li>
<li>
<p>Registers an "xmldatetimeoffset" Handlerbars helper that offsets the date/time to something equivalent in a specific timezone. Ridiculous right! You might only need this if you are unlucky enough to deal with
legacy systems that don't deal with different timezones very well.</p>

<p>It allows you to capture something like 2015-12-29 12:30 GMT+06 and convert it to 2015-12-29 12:30 GMT+10. I.e. something that looks the same when viewed in a different timezone. You can use it like this:</p>

<pre><code>&lt;mytimestamp&gt;{{{xmldatetimeoffset myDateTime}}}&lt;/mytimestamp&gt;
&lt;mytimestamp&gt;{{{xmldatetimeoffset myDateTime mySourceTimezoneOffset}}}&lt;/mytimestamp&gt;
&lt;mytimestamp&gt;{{{xmldatetimeoffset myDateTime mySourceTimezoneOffset myTargetTimezone}}}&lt;/mytimestamp&gt;
&lt;mytimestamp&gt;{{{xmldatetimeoffset myDateTime mySourceTimezoneOffset myTargetTimezone myAlternateFormat}}}&lt;/mytimestamp&gt;
</code></pre>

<p>If you don't specify a source timezone offset (mySourceTimezoneOffset) then myDateTime.getTimezoneOffset() will be used.</p>

<p>If you don't specify a target timezone (myTargetTimezone) then "Australia/Melbourne" will be used.</p>

<p>If you don't specify an alternate custom format then the standard XML date/time format (YYYY-MM-DDTHH:mm:ss.SSSZ) will be used.</p>
</li>
</ul>

<h6>
<a id="soaprequestoptions" class="anchor" href="#soaprequestoptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>soapRequest:options</h6>

<ul>
<li>
<p>url</p>

<p>Mandatory. String. The service endpoint url.</p>
</li>
<li>
<p>handlebarsTemplate</p>

<p>Mandatory. String. The path to the Handlebars template file.</p>
</li>
<li>
<p>handlebarsParams</p>

<p>Optional. Object. The JSON data to be provided to the Handlebars template</p>
</li>
<li>
<p>handlebarsPartials</p>

<p>Optional. Array of { name: 'nameForPartial', filename: 'path/to/partial' }.</p>

<p>Partial template files are loaded and registered under the specified name.</p>
</li>
<li>
<p>soapAction</p>

<p>Optional. String. If specified, a soap11 request will be sent. The SOAPAction header will contain the value specified here.</p>
</li>
<li>
<p>requestHeaders</p>

<p>Optional. Object. If specified, will be used in place of the default soap12 or soap11 headers.</p>
</li>
<li>
<p>xmlResponse</p>

<p>Optional. Boolean. If true, the response will be the unaltered SOAP/XML body from the service.</p>
</li>
<li>
<p>errorLogger</p>

<p>Optional. Function. The default error logging behaviour is to console.log the details. To override this you need to specify your own errorLogger like this:</p>

<pre><code>//The errorLogger function will be called before the service is invoked so that any initial setup can be done
var myErrorLogger = function(serviceName) {
    var st = Date.now(); //E.g. We may want to remember the current time so we can log the duration of the failed service call
    return {
        //The onError function is only called if an error is returned by the service (including unexpected SOAP Faults). This is where the error logging should happen
        onError: function(soapReq, errorResponse) {
            var duration = Date.now() - st;
        }
    };
};

var options = {
    handlebarsTemplate: '/path/to/my/template/file',
    handlebarsParams: jsonParams,
    url: 'http://my/service/endpoint',
    errorLogger: myErrorLogger
};
</code></pre>
</li>
<li>
<p>serviceName</p>

<p>Optional. String. If provided, will be passed to the start method of the error logger as the serviceName used to identify the service being invoked. If not provided, the url will be passed to the error logger instead.</p>
</li>
<li>
<p>isExpectedFault</p>

<p>Optional. Function returning a boolean. If you need to recognise certain SOAP Faults as expected behaviour (not errors) then you can provide your own isExpectedFault function. Here is an example:</p>

<pre><code>function isExpectedFault(json) {
    return !!xml2json.getChildNode(json.root, ['Body','Fault','Detail','SomeExpectedException']);
}

var options = {
    handlebarsTemplate: '/path/to/my/template/file',
    url: 'http://my/service/endpoint',
    isExpectedFault: isExpectedFault
};
</code></pre>
</li>
</ul>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/dennoa">dennoa</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
